import type { GetNextProducts, GetProducts } from '../types';
import type ResponseSchema from './ResponseSchema';
import { getJsonToProducts } from '$lib/product_sources/getJsonToProductsData.server';
import { headers } from '$lib/product_sources/constants';

export const getProducts: GetProducts = async (code, maxItems, config) => {
	// const nItems = Math.min(maxItems, 10);

	const axiosReqConfig = {
		method: 'POST',
		url: 'https://www.fleetguard.com/webruntime/api/apex/execute',
		params: { language: 'en-US', asGuest: 'true', htmlEncode: 'false' },
		headers: {
			...headers,
			Accept: '*/*',
			'Accept-Encoding': 'gzip, deflate, br, zstd',
			'Accept-Language': 'en-US,en;q=0.9',
			'Cache-Control': 'no-cache',
			Connection: 'keep-alive',
			'Content-Type': 'application/json',
			Host: 'www.fleetguard.com',
			Origin: 'https://www.fleetguard.com',
			Pragma: 'no-cache',
			Priority: 'u=4',
			Referer: 'https://www.fleetguard.com/results',
			'Sec-Fetch-Dest': 'empty',
			'Sec-Fetch-Mode': 'no-cors',
			'Sec-Fetch-Site': 'same-origin',
			'Sec-GPC': '1',
			TE: 'trailers'
		},
		data: {
			namespace: '',
			classname: '@udd/01pPL000001p0qx',
			method: 'getProductDetailsFromParts',
			isContinuation: false,
			params: {
				ids: [
					'01t5x000008FGnvAAG',
					'01t5x000008FGnwAAG',
					'01t5x000008GbrQAAS',
					'01t5x000008FCGzAAO',
					'01t5x000008FFgxAAG',
					'01t5x000008FDWIAA4',
					'01t5x000008FCPZAA4',
					'01t5x000008FDRYAA4',
					'01t5x000008FDw5AAG',
					'01t5x000008FDN8AAO',
					'01t5x000008FBwUAAW',
					'01t5x000008FCBMAA4',
					'01t5x000008FCBNAA4',
					'01t5x000008FC9FAAW',
					'01t5x000008FC9HAAW',
					'01t5x000008FC35AAG',
					'01t5x000008FDzsAAG',
					'01t5x000008FDoKAAW',
					'01t5x000008FDoLAAW',
					'01t5x000008FGdNAAW',
					'01t5x000008FGiWAAW',
					'01t5x000008FDEbAAO',
					'01t5x000008FGdQAAW',
					'01t5x000008FFtWAAW',
					'01t5x000008FFs0AAG',
					'01t5x000008FFsCAAW',
					'01t5x000008FFruAAG',
					'01t5x000008FFZnAAO',
					'01t5x000008FFkDAAW',
					'01t5x000008FDEdAAO',
					'01t5x000008FDEfAAO',
					'01t5x000008FFo8AAG',
					'01t5x000008FGLfAAO',
					'01t5x000008FFpdAAG',
					'01t5x000008FFpNAAW',
					'01t5x000008FFpOAAW',
					'01t5x000008FH1LAAW',
					'01t5x000008FH1bAAG',
					'01t5x000008FGQFAA4',
					'01t5x000008FGSFAA4',
					'01t5x000008FDEhAAO',
					'01t5x000008FGStAAO',
					'01t5x000008FDFnAAO',
					'01t5x000008FFe4AAG',
					'01t5x000008GbIgAAK',
					'01t5x000008FDHZAA4',
					'01t5x000008FDOOAA4',
					'01t5x000008FGwwAAG',
					'01t5x000008FGwxAAG',
					'01t5x000008FC8MAAW',
					'01t5x000008FH1iAAG',
					'01t5x000008FCCZAA4',
					'01t5x000008FCCiAAO',
					'01t5x000008FCHOAA4',
					'01t5x000008FFhTAAW',
					'01t5x000008FFbiAAG',
					'01t5x000008FE4AAAW',
					'01t5x000008FE71AAG',
					'01t5x000008FN61AAG',
					'01t5x000008FDFeAAO',
					'01t5x000008FE5vAAG',
					'01t5x000008FELXAA4',
					'01t5x000008FEMNAA4',
					'01t5x000008FPbVAAW',
					'01t5x000008FCaeAAG',
					'01t5x000008FEAlAAO',
					'01t5x000008FBqfAAG',
					'01t5x000008FC2FAAW',
					'01t5x000008FCVDAA4',
					'01t5x000008FC1jAAG',
					'01t5x000008FCVYAA4',
					'01t5x000008FCVEAA4',
					'01t5x000008FCVFAA4',
					'01t5x000008FCVGAA4',
					'01t5x000008FCVHAA4',
					'01t5x000008FCUqAAO',
					'01t5x000008FC2iAAG',
					'01t5x000008FCUmAAO',
					'01t5x000008FCO8AAO',
					'01t5x000008FBmUAAW',
					'01t5x000008FBtlAAG',
					'01t5x000008FDNHAA4',
					'01t5x000008FGokAAG',
					'01t5x000008FGolAAG',
					'01t5x000008FGUwAAO',
					'01t5x000008FGomAAG',
					'01t5x000008FGonAAG',
					'01t5x000008FGp0AAG',
					'01t5x000008FDRyAAO',
					'01t5x000008FHEYAA4',
					'01t5x000008FHEZAA4',
					'01t5x000008FHEwAAO',
					'01t5x000008FGSIAA4',
					'01t5x000008FDRzAAO',
					'01t5x000008FFrLAAW',
					'01t5x000008FDoqAAG',
					'01t5x000008FDbuAAG',
					'01t5x000008FDbvAAG',
					'01t5x000008FGSKAA4',
					'01t5x000008FDgvAAG',
					'01t5x000008FDS1AAO',
					'01t5x000008FFoJAAW',
					'01t5x000008FFoHAAW',
					'01t5x000008FB87AAG',
					'01t5x000008FAprAAG',
					'01t5x000008FFySAAW',
					'01t5x000008FDTTAA4',
					'01t5x000008FDTWAA4',
					'01t5x000008FGeIAAW',
					'01t5x000008FGSRAA4',
					'01t5x000008FGdVAAW',
					'01t5x000008FGO5AAO',
					'01t5x000008FGO9AAO',
					'01t5x000008FGObAAO',
					'01t5x000008FDTcAAO',
					'01t5x000008FFkLAAW',
					'01t5x000008FFkgAAG',
					'01t5x000008GblPAAS',
					'01t5x000008FDmiAAG',
					'01t5x000008FEaZAAW',
					'01t5x000008FAq0AAG',
					'01t5x000008FFnxAAG',
					'01t5x000008FFiZAAW',
					'01t5x000008FGLjAAO',
					'01t5x000008FGLkAAO',
					'01t5x000008FGMOAA4',
					'01t5x000008FGMPAA4',
					'01t5x000008FGMQAA4',
					'01t5x000008FDUJAA4',
					'01t5x000008FGMYAA4',
					'01t5x000008FGT3AAO',
					'01t5x000008FGVfAAO',
					'01t5x000008FGUNAA4',
					'01t5x000008FGVSAA4',
					'01t5x000008GcROAA0',
					'01t5x000008FC8lAAG',
					'01t5x000008FE2KAAW',
					'01t5x000008FGr3AAG',
					'01t5x000008FDENAA4',
					'01t5x00000KX7taAAD',
					'01t5x000008FMSQAA4',
					'01t5x000008FEM7AAO',
					'01t5x000008FDlzAAG',
					'01t5x000008FDeSAAW',
					'01t5x000008FFwRAAW',
					'01t5x000008FFwTAAW',
					'01t5x000008FFwWAAW',
					'01t5x000008FFv3AAG',
					'01t5x000008FFv4AAG',
					'01t5x000008FBZGAA4',
					'01t5x000008FFudAAG',
					'01t5x000008FDKNAA4',
					'01t5x000008FDmVAAW',
					'01t5x000008FEJhAAO',
					'01tPL000005LV4LYAW',
					'01t5x000008FG3tAAG',
					'01t5x000008FG3uAAG',
					'01t5x000008FG3yAAG',
					'01t5x000008FGYuAAO',
					'01t5x000008FGYDAA4',
					'01t5x000008FGYgAAO',
					'01t5x000008FD9TAAW',
					'01t5x000008FGYkAAO',
					'01t5x000008FGZ2AAO',
					'01t5x000008FGZ9AAO',
					'01t5x000008FGZIAA4',
					'01t5x000008FGoXAAW',
					'01t5x000008FGl3AAG',
					'01t5x000008FFtOAAW',
					'01t5x000008FG7lAAG',
					'01t5x000008FG8VAAW',
					'01t5x000008FG8aAAG',
					'01t5x000008FHFMAA4',
					'01t5x000008FCDcAAO',
					'01t5x000008FDDCAA4',
					'01t5x000008FC5TAAW',
					'01t5x000008FC7kAAG',
					'01t5x000008FE04AAG',
					'01t5x000008FBsiAAG',
					'01t5x000008FDBWAA4',
					'01t5x000008FBsuAAG',
					'01t5x000008FC2hAAG',
					'01t5x000008FCVfAAO',
					'01t5x000008FBqcAAG',
					'01t5x000008FBqbAAG',
					'01t5x000008FBshAAG',
					'01t5x000008FCIkAAO',
					'01t5x000008FDIbAAO',
					'01t5x000008FBqDAAW',
					'01t5x000008FBbEAAW',
					'01t5x000008FENKAA4',
					'01t5x000008FGLCAA4',
					'01t5x000008FKBlAAO',
					'01t5x000008FHG2AAO',
					'01t5x000008FBoXAAW',
					'01t5x000008FDn5AAG',
					'01t5x000008FHGEAA4',
					'01t5x000008FHGIAA4',
					'01t5x000008FHDnAAO',
					'01t5x000008FHDvAAO',
					'01t5x000008FGA3AAO',
					'01t5x000008FG6MAAW',
					'01t5x000008FGDcAAO',
					'01t5x000008FD9VAAW',
					'01t5x000008FFgrAAG',
					'01t5x000008FE8KAAW',
					'01t5x000008FE8OAAW',
					'01t5x000008FEDeAAO',
					'01t5x000008FCN3AAO',
					'01t5x000008FDT4AAO',
					'01t5x000008FDT6AAO',
					'01t5x000008FCVVAA4',
					'01t5x000008FBl1AAG',
					'01t5x000008FBxdAAG',
					'01t5x000008FBaGAAW',
					'01t5x000008FBxDAAW',
					'01t5x000008FDIcAAO',
					'01t5x000008FDSEAA4',
					'01t5x000008FDg6AAG',
					'01t5x000008FN1oAAG',
					'01t5x000008FDgCAAW',
					'01t5x000008FN1AAAW',
					'01t5x000008FDd9AAG',
					'01t5x000008FGLGAA4',
					'01t5x000008FGLHAA4',
					'01t5x000008FE9fAAG',
					'01t5x000008FMKqAAO',
					'01t5x000008FMIvAAO',
					'01t5x000008FDIaAAO',
					'01t5x000008FDc2AAG',
					'01t5x000008FG4rAAG',
					'01t5x000008FG2oAAG',
					'01t5x000008FG2yAAG',
					'01t5x000008FBfRAAW',
					'01t5x000008FCGbAAO',
					'01t5x000008FAq3AAG',
					'01t5x000008FB8oAAG',
					'01t5x00000KMOBuAAP',
					'01tPL000001ozxOYAQ',
					'01tPL0000067zcoYAA',
					'01t5x000008FEMMAA4',
					'01t5x000008FEN1AAO',
					'01t5x000008FH3OAAW',
					'01t5x000008FFhLAAW',
					'01t5x000008FFgsAAG',
					'01t5x000008FN5hAAG',
					'01t5x000008FE79AAG',
					'01t5x000008FE7sAAG',
					'01t5x000008FDcBAAW',
					'01t5x000008FDmTAAW',
					'01t5x000008FBaTAAW',
					'01t5x000008FBcrAAG',
					'01t5x000008FFc2AAG',
					'01t5x000008FGvXAAW',
					'01t5x000008FFfcAAG',
					'01t5x000008FFeYAAW',
					'01t5x000008FFeZAAW',
					'01t5x000008FFeeAAG',
					'01t5x000008FHBtAAO',
					'01t5x000008FHD9AAO',
					'01t5x000008FH6HAAW',
					'01t5x000008FFgiAAG',
					'01t5x000008FFaYAAW',
					'01t5x000008FFaZAAW',
					'01t5x000008FFadAAG',
					'01t5x000008FFahAAG',
					'01t5x000008FFakAAG',
					'01t5x000008FH7MAAW',
					'01t5x000008FH7NAAW',
					'01t5x000008FH7sAAG',
					'01t5x000008FH4NAAW',
					'01t5x000008FH5WAAW',
					'01t5x000008FH5EAAW',
					'01t5x000008FGAQAA4',
					'01t5x000008FGAVAA4',
					'01t5x000008FGCEAA4',
					'01t5x000008FGAgAAO',
					'01t5x000008FGuSAAW',
					'01t5x000008FN5qAAG',
					'01t5x000008FCFcAAO',
					'01t5x000008FGxZAAW',
					'01t5x000008FGySAAW',
					'01t5x000008FGyUAAW',
					'01t5x000008FGxzAAG',
					'01t5x000008FGZbAAO',
					'01t5x000008FGp7AAG',
					'01t5x000008FGpgAAG',
					'01t5x000008FGpZAAW',
					'01t5x000008FGqcAAG',
					'01t5x000008FBgMAAW',
					'01t5x000008FBgOAAW',
					'01t5x000008FBgPAAW',
					'01t5x000008FBgRAAW',
					'01t5x000008FBiaAAG',
					'01t5x000008FBidAAG',
					'01t5x000008FByOAAW',
					'01t5x000008FBt8AAG',
					'01t5x000008FGcuAAG',
					'01t5x000008FGZrAAO',
					'01t5x000008FG7oAAG',
					'01t5x000008FG9eAAG',
					'01t5x000008FG9dAAG',
					'01t5x000008FELoAAO',
					'01t5x000008FF5RAAW',
					'01t5x000008FKBxAAO',
					'01t5x000008FE0WAAW',
					'01t5x000008FFhOAAW',
					'01t5x000008FN5sAAG',
					'01t5x000008FDSqAAO',
					'01t5x000008FCSwAAO',
					'01t5x000008FBqaAAG',
					'01t5x000008FBsjAAG',
					'01t5x000008FGLBAA4',
					'01t5x000008FGL8AAO',
					'01t5x000008FL14AAG',
					'01t5x00000KM5tsAAD',
					'01t5x000008FBvkAAG',
					'01t5x000008FBw7AAG',
					'01t5x000008FBazAAG',
					'01t5x000008FGSbAAO',
					'01t5x000008FDY2AAO',
					'01t5x000008FDgcAAG',
					'01tPL000004WXzTYAW',
					'01t5x000008FG79AAG',
					'01t5x000008FFciAAG',
					'01t5x000008FFcmAAG',
					'01t5x000008FFcqAAG',
					'01t5x000008FFcvAAG',
					'01t5x000008FH9WAAW',
					'01t5x000008GcWFAA0',
					'01t5x000008FH4TAAW',
					'01t5x000008FH4UAAW',
					'01t5x000008FFfGAAW',
					'01t5x000008FGwSAAW',
					'01t5x000008FC9dAAG',
					'01t5x000008FGBhAAO',
					'01t5x000008FGBaAAO',
					'01t5x000008FH2QAAW',
					'01t5x000008FGBEAA4',
					'01t5x000008FBNvAAO',
					'01t5x000008FCChAAO',
					'01t5x000008FCDbAAO',
					'01t5x000008FDDxAAO',
					'01t5x000008FH2xAAG',
					'01t5x000008FFblAAG',
					'01t5x000008FDZ8AAO',
					'01t5x000008FBNyAAO',
					'01t5x000008FBO8AAO',
					'01t5x000008FBO7AAO',
					'01t5x000008FD9pAAG',
					'01t5x000008FD9qAAG',
					'01t5x000008FDBBAA4',
					'01t5x000008FDCHAA4',
					'01t5x000008FGq6AAG',
					'01t5x000008FGq7AAG',
					'01t5x000008FGqMAAW',
					'01t5x000008FGqQAAW',
					'01t5x000008FGqSAAW',
					'01t5x000008FGqUAAW',
					'01t5x000008FGqWAAW',
					'01t5x000008FGqeAAG',
					'01t5x000008FGqfAAG',
					'01t5x000008FGqtAAG',
					'01t5x000008FGqwAAG',
					'01t5x000008FGrCAAW',
					'01t5x000008FGrFAAW',
					'01t5x000008FGrGAAW',
					'01t5x000008FGrIAAW',
					'01t5x000008FGrKAAW',
					'01t5x000008FD9OAAW',
					'01t5x000008FGa3AAG',
					'01t5x000008FGaKAAW',
					'01t5x000008FGaeAAG',
					'01t5x000008FGbWAAW',
					'01t5x000008FGcgAAG',
					'01t5x000008FGciAAG',
					'01t5x000008FGaWAAW',
					'01t5x000008FD9QAAW',
					'01t5x000008FDIBAA4',
					'01t5x000008FCUgAAO',
					'01t5x000008FGaSAAW',
					'01t5x000008FG8AAAW',
					'01t5x000008FDIHAA4',
					'01t5x000008FDIIAA4',
					'01t5x000008FDIJAA4',
					'01t5x000008FDIKAA4',
					'01t5x000008FE2PAAW',
					'01t5x000008FE5OAAW',
					'01t5x000008FE5PAAW',
					'01t5x000008FE5VAAW',
					'01t5x000008FE5aAAG',
					'01t5x000008FE5bAAG',
					'01t5x000008FE6NAAW',
					'01t5x000008FE6OAAW',
					'01t5x000008FE9SAAW',
					'01t5x000008FGTxAAO',
					'01t5x000008FGTuAAO',
					'01t5x000008FGVVAA4',
					'01t5x000008FGXaAAO',
					'01t5x000008FGXdAAO',
					'01t5x000008FGPJAA4',
					'01t5x000008FDLvAAO',
					'01t5x000008FDLyAAO',
					'01t5x000008FDM6AAO',
					'01t5x000008FDNQAA4',
					'01t5x000008FDNgAAO',
					'01t5x000008FDChAAO',
					'01t5x000008FDCiAAO',
					'01t5x000008FDCjAAO',
					'01t5x000008FDCkAAO',
					'01t5x000008FDDLAA4',
					'01t5x000008FFhbAAG',
					'01t5x000008FFhdAAG',
					'01t5x000008FGB0AAO',
					'01t5x000008FGCpAAO'
				],
				searchTerm: code,
				pageNumber: 1,
				pageSize: '32'
			},
			cacheable: false
		}
	};
	try {
		return getJsonToProducts<ResponseSchema>(
			'fleetguard',
			axiosReqConfig,
			{
				rowsIterator: (resData) => {
					console.log(resData);
					const products: Product[] = [];
					if (resData?.returnValue?.items != undefined) {
						for (let i = 0; i < resData?.returnValue?.items?.length; i++) {
							const row = resData?.returnValue?.items?.[i];
							if (row != undefined) {
								products.push({
									manufacturer:
										row.productDetailsWrapper.eqManufacturer ??
										'no manufacturer ðŸ—¿',
									manufacturer_code:
										row.productDetailsWrapper.crossReferenceName ??
										'no manuf. code ðŸ§',
									source_reference_code:
										row.productDetailsWrapper.productName ?? 'no cross code ðŸ§',
									thumbnails: [row.imageUrl]
								});
							}
						}
					}
					return products;
				}
			},
			config
		);
	} catch (err) {
		console.error('Fleetguard error', err);
		return {
			meta: {
				status: 500,
				currentItemsDisplayed: 0,
				totalItems: 0,
				maxItemsPagination: null,
				page: 0
			},
			products: []
		};
	}
};

export const getNextProducts: GetNextProducts = () => null;
